#!/usr/bin/env zsh

# --- Color Definitions ---
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[0;37m'
NC='\033[0m' # No Color

# --- Function to Display a Menu ---
display_menu() {
  echo "${BLUE}--- Docker Management Menu ---${NC}"
  echo "1. ${GREEN}Clean Up Docker (Stop/Remove Containers, Images, Volumes)${NC}"
  echo "2. ${GREEN}Start Docker Compose${NC}"
  echo "3. ${GREEN}Show Running Containers${NC}"
  echo "4. ${GREEN}Show Docker Compose Status${NC}"
  echo "5. ${RED}Exit${NC}"
  echo -n "Enter your choice (1-5): "
}

# --- Function to Clean Up Docker ---
clean_up_docker() {
  echo "${YELLOW}Cleaning up Docker...${NC}"
  echo "${CYAN}Stopping all running containers...${NC}"
  docker stop $(docker ps -aq) 2>/dev/null || true

  echo "${CYAN}Removing all stopped containers...${NC}"
  docker rm $(docker ps -aq) 2>/dev/null || true

  echo "${CYAN}Removing all images...${NC}"
  docker rmi $(docker images -q) 2>/dev/null || true

  echo "${CYAN}Removing all unused volumes...${NC}"
  docker volume prune -f 2>/dev/null || true
  echo "${GREEN}Docker cleanup complete.${NC}"
}

# --- Function to Start Docker Compose ---
start_docker_compose() {
  echo "${YELLOW}Starting Docker Compose...${NC}"
  if docker-compose up -d
  then
    echo "${GREEN}Docker Compose started successfully.${NC}"
  else
    echo "${RED}Error: Docker Compose failed to start.${NC}"
    return 1 # Indicate failure
  fi
  return 0 # Indicate success
}

# --- Function to Show Running Containers ---
show_running_containers() {
  echo "${BLUE}--- Running Containers: ---${NC}"
  docker ps
}

# --- Function to Show Docker Compose Status ---
show_docker_compose_status() {
  echo "${BLUE}--- Docker Compose Status: ---${NC}"
  docker-compose ps
}

# --- Main Loop ---
while true
do
  display_menu
  read choice

  case $choice in
    1)
      clean_up_docker
      ;;
    2)
      if start_docker_compose; then
        show_running_containers
        show_docker_compose_status
      fi
      ;;
    3)
      show_running_containers
      ;;
    4)
      show_docker_compose_status
      ;;
    5)
      echo "Exiting..."
      exit 0
      ;;
    *)
      echo "${RED}Invalid choice. Please enter a number between 1 and 5.${NC}"
      ;;
  esac

  echo "" # Add a newline for readability
done

